# Makefile for building linux/TstBootStrap
# Generated by tmake at 10:35, 2001/07/12
#     Project: TstBootStrap
#    Template: app
#############################################################################

####### Compiler, tools and options

#define this for debug version
#DEBUG=1

#
# Bluelight high performance kernel rules
#
ifdef DEBUG
    DBG_CXXFLAGS = -D_DEBUG=1 -g 
    DBG_CFLAGS = -D_DEBUG=1 -g 
    else
    DBG_CXXFLAGS = -O2
    DBG_CFLAGS = -O2
endif

ifdef BLHPK
    BLHPK_DIR = ../../blhpk
    include $(BLHPK_DIR)/include/Make.Rules
    include $(BLHPK_DIR)/include/Make.config
    
    BLHPK_INC = -I $(BLHPK_DIR)/include
    
    OBJDIR := blhpk
    OS_CFLAGS := -DBLHPK=1
    
    #
    # high performance kernel io module...
    #
    BLIO_MODULE = blrudp_iohpk.o
	

$(OBJDIR)/%.o : %.c
	$(CC) -c  $(OS_CFLAGS) $(DBG_CFLAGS) $(KFLAGS) $(CFLAGS) $(INCPATH) -o $@  $<
	
$(OBJDIR)/%.o : ../common/%.c
	$(CC) -c $(OS_CFLAGS) $(DBG_CFLAGS) $(KFLAGS) $(CFLAGS) $(CXXFLAGS) $(INCPATH)  -o $@  $<
	

else
    BLHPK_INC = 


    CP=/bin/cp -p
    RM=/bin/rm -f
    TAR=/bin/tar
    TOUCH=/bin/touch
    MKDEP=makedepend

    OS := $(shell uname)
    
    
    OBJDIR = linux
    
    ifeq ($(OS),Linux)
	OBJDIR = linux
	OS_CFLAGS= -DLINUX=1
    endif
    
    ifeq ($(OS),AIX)
	OBJDIR = aix
	OS_CFLAGS= -DAIX=1
    endif
    
    ifeq ($(OS),CYGWIN_NT-5.0)
	OBJDIR = cygwin
	OS_CFLAGS= -DCYGWIN=1 
	SUBLIBS=-lwsock32
    endif


    #PROFILE =       -pg
    CC  =       xlC
    CXX =       xlC
   
    CFLAGS      = -qcpluscmt $(DBG_CFLAGS) $(OS_CFLAGS) $(PROFILE)
    CXXFLAGS    = -qcpluscmt $(DBG_CXXFLAGS) $(OS_CFLAGS) $(PROFILE)
   
    LIBS        =       $(SUBLIBS)
    LINK        =       xlC


    AR	=	ar rs
    LFLAGS	=	

    #
    # linux AIX etc... io module...
    #
    BLIO_MODULE = blrudp_io.o

$(OBJDIR)/%.o : %.c
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o $@  $<
	
$(OBJDIR)/%.o : ../common/%.c
	$(CC) -c $(CXXFLAGS) $(INCPATH) -o $@  $<
	

endif

	

#
# intermixed asm listing.
#
ASMLIST = -Wa,-ahls=$*.listing 

INCPATH	=	-I..  -I../include $(BLHPK_INC)


TAR	=	tar -cf
GZIP	=	gzip -9f


TARGET	=	$(OBJDIR)/blrudp.a

####### Files

#
# src files for makedepend....
#

SRC :=  blrudp.c \
		blmap.c \
		bltimemgr.c \
		blrudppkt.c \
		blrudppkt_help.c \
		blrudp_common.c \
		blrudp_io.c \
		blrudp_state.c \
		blrudp_pktpool.c \
		blrudp_pktstatus.c \
		blrudpwork.c \
		../common/dbgPrint.c
		

OBJECTS =	$(OBJDIR)/blrudp.o\
		$(OBJDIR)/blmap.o\
		$(OBJDIR)/bltimemgr.o\
		$(OBJDIR)/blrudppkt.o\
		$(OBJDIR)/blrudppkt_help.o\
		$(OBJDIR)/blrudp_common.o\
		$(OBJDIR)/blrudp_state.o\
		$(OBJDIR)/blrudp_pktpool.o\
		$(OBJDIR)/blrudp_pktstatus.o\
		$(OBJDIR)/blrudpwork.o\
		$(OBJDIR)/blrudp_sapmgr.o \
		$(OBJDIR)/dbgPrint.o \
		$(OBJDIR)/$(BLIO_MODULE) \
		


all: $(OBJDIR)/. $(TARGET)

$(OBJDIR)/.:
	mkdir $(OBJDIR)

$(TARGET): $(OBJECTS) 
	$(AR)  $(TARGET) $(OBJECTS) 



clean:
	-rm -f $(OBJECTS) $(OBJMOC) $(SRCMOC) $(UICIMPLS) $(UICDECLS) $(TARGET)
	-rm -f *~ core
	-rm -f *.listing

depend::
	# Not using this yet.  appears to have a headache with using the OBJDIR field...
	#$(TOUCH) Make.depend
	#$(MKDEP) -p $(OBJDIR)/ -f Make.depend  -- $(CFLAGS) $(AFLAGS) -- $(SRC) 2>/dev/null
	#$(RM) Make.depend.bak

fresh: clean all


$(OBJDIR)/dbgPrint.o: ../common/dbgPrint.c\
			    ../include/dbgPrint.h

$(OBJDIR)/blrudp.o: blrudp.c\
			    blrudp.h\
	 		    qlink.h \
			    ../include/hostcfg.h\
			    ../include/BlErrors.h


$(OBJDIR)/blmap.o: blmap.c\
			    blmap.h


$(OBJDIR)/bltimemgr.o: bltimemgr.c\
	           bltimemgr.h\
	           qlink.h 


$(OBJDIR)/blrudppkt_help.o: blrudppkt_help.c\
        blrudppkt.h\
        qlink.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        bltimemgr.h\
        qlink.h



$(OBJDIR)/blrudppkt.o: blrudppkt.c\
        blrudppkt.h\
        qlink.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        bltimemgr.h\
        qlink.h


$(OBJDIR)/blrudp_common.o: blrudp_common.c\
        ../include/hostcfg.h\
        ../include/BlErrors.h\
        blrudp_common.h\
        blrudppkt.h\
        ../include/gdb_stdint.h\
        qlink.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        bltimemgr.h\
        blrudp_state.h\
        blrudppkt_help.h\
        blrudp_pktpool.h\
        blrudp_io.h\
        ../include/dbgPrint.h


$(OBJDIR)/blrudp_io.o: blrudp_io.c\
        ../include/hostcfg.h\
        ../include/gdb_stdint.h\
        blrudp_io.h

$(OBJDIR)/blrudp_iohpk.o: blrudp_iohpk.c\
        ../include/hostcfg.h\
        ../include/gdb_stdint.h\
        blrudp_io.h


$(OBJDIR)/blrudp_pktpool.o: blrudp_pktpool.c\
        ../include/hostcfg.h\
        blrudp_pktpool.h\
        blrudppkt.h\
        ../include/gdb_stdint.h\
        qlink.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        bltimemgr.h\
        ../include/dbgPrint.h

$(OBJDIR)/blrudp_state.o: blrudp_state.c\
        ../include/hostcfg.h\
        blrudp_state.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        blrudppkt.h\
        ../include/gdb_stdint.h\
        qlink.h\
        bltimemgr.h\
        blrudp_common.h\
        blrudppkt_help.h\
        ../include/dbgPrint.h

$(OBJDIR)/blrudpwork.o: blrudpwork.c\
        ../include/hostcfg.h\
        blrudpwork.h\
        ../include/gdb_stdint.h\
        qlink.h\
        ../include/dbgPrint.h



$(OBJDIR)/blrudp_pktstatus.o: blrudp_pktstatus.c\
        ../include/hostcfg.h\
        ../include/BlErrors.h\
        blrudp_memory.h\
        blrudp_pktstatus.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        blrudppkt.h\
        ../include/gdb_stdint.h\
        qlink.h\
        bltimemgr.h\
        blrudpwork.h\
        blrudp_pktpool.h\
        ../include/dbgPrint.h\
        bldefs.h


$(OBJDIR)/blrudp_sapmgr.o: blrudp_sapmgr.c\
        ../include/hostcfg.h\
        ../include/BlErrors.h\
        blrudp_sapmgr.h\
        qlink.h\
        ../include/dbgPrint.h\
        ../include/gdb_stdint.h\
        blrudp_io.h\
        blrudppkt.h\
        blrudp_memory.h\
        blrudp_st.h\
        blrudp.h\
        blmap.h\
        bltimemgr.h\
        blrudpwork.h\
        blrudp_pktpool.h\
        bldefs.h


$(OBJDIR)/dbgtimelog.o: ../common/dbgtimelog.c\
        ../include/gdb_stdint.h\
        ../include/dbgtimelog.h

#
# don't do this until we can get the subdirectory thing working with makedepend....
#
#-include Make.depend

